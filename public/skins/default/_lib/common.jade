
mixin media(type, width, height)
  if media == type
    skin(width=width height=height)
      block

mixin longnote(x, cur, add, visible)
  // body
  sprite(image='Note/DX/Note.png'
          frame=(cur.width + 'x64+' + cur.x + '+' + (22 + add))
          x=(x)
          y=('(y*'+area_height+')+4-12')
          width=(cur.width)
          height=('height*'+area_height)
          visible=visible)
  // tail
  sprite(image='Note/DX/Note.png'
          frame=(cur.width + 'x8+' + cur.x + '+' + (104 + add))
          x=(x)
          y='((y+height)*'+area_height+')+4-12'
          visible=visible)
  // head
  sprite(image='Note/DX/Note.png'
          frame=(cur.width + 'x8+' + cur.x + '+' + (12 + add))
          x=(x)
          y='(y*'+area_height+')-12'
          visible=visible)

mixin notes(columns)
  - var x = 0
  each column in columns
    - var cur = styles[column.style]
    - var ch  = column.channel
    sprite(image='Note/DX/Highlight.png'
            frame=(cur.width + 'x552+' + cur.x + '+0')
            x=(x) y='0' blend='screen' scale-x='1')
      animation
        keyframe(t='0' alpha='0' scale-x='1')
      animation(on='p1_' + ch + '_down')
        keyframe(t='0' alpha='1' scale-x='1')
      animation(on='p1_' + ch + '_up')
        keyframe(t='0' alpha='1' scale-x='1' x=(x))
        keyframe(t='0.18' ease='quadOut' alpha='0' scale-x='0' x=(x + cur.width / 2))
    object(key='p1_note_' + ch)
      sprite(image='Note/DX/Note.png' frame=(cur.width + 'x12+' + cur.x + '+0')
              x=(x) y='(y*'+area_height+')-12')
    object(key='p1_longnote_' + ch)
      +longnote(x, cur, 0, '!active && !missed')
      +longnote(x, cur, 100, '!!active && !missed')
      +longnote(x, cur, 200, '!!missed')

    - x = x + cur.width + 1

mixin note-area(modeObject)
  sprite(image=modeObject.background x='0' y='0')
  sprite(image='NoteArea/Flash.png' x='1' y='455' blend='screen'
          alpha='1 - (t % 0.4) / 0.4')
  group(x='1' mask='283x550+1+0')
    +notes(modeObject.columns)

mixin judgments
  +judgment('1')
    +judgment-text('Meticulous')(text='*%s' data='p1_combo')
  +judgment('2')
    +judgment-text('Precise')(text='*%s' data='p1_combo')
  +judgment('3')
    +judgment-text('Good')(text='*%s' data='p1_combo')
  +judgment('4')
    +judgment-text('Other')(text='1')
  +judgment('missed')
    +judgment-text('Other')(text='0')

mixin judgment-text(name)
  text(font='BemuseDefault-'+name font-src='Fonts/BemuseDefault-'+name+'.fnt')&attributes(attributes)

mixin judgment(type)
  group(alpha='0')
    +judgment-animation(type)
    block

mixin judgment-animation(type)
  animation(on='p1_judge_1'):       +judgment-keyframes((type == '1'))
  animation(on='p1_judge_2'):       +judgment-keyframes((type == '2'))
  animation(on='p1_judge_3'):       +judgment-keyframes((type == '3'))
  animation(on='p1_judge_4'):       +judgment-keyframes((type == '4'))
  animation(on='p1_judge_missed'):  +judgment-keyframes((type == 'missed'))

mixin judgment-keyframes(active)
  if active
    keyframe(t='0' y='-16' alpha='1')
    keyframe(t='0.1' y='0' ease='quadOut')
    keyframe(t='0.6' alpha='1')
    keyframe(t='1' alpha='0')
  else
    keyframe(t='0' alpha='0')
